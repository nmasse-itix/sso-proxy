#!/bin/bash

test -f /opt/app-root/etc/generate_container_user && source /opt/app-root/etc/generate_container_user

set -e

# Default values are set here
export "LOG_LEVEL=${LOG_LEVEL:=info}"
export "NGINX_CONF=${NGINX_CONF:=/opt/app-root/etc/}"

if [ -f "$NGINX_CONF/nginx.env.conf" ]; then
  envsubst '$LOG_LEVEL:$RESOLVER:$APP_ROOT:$SSO_SERVICE_HOSTNAME:$PROXY_ROUTE_HOSTNAME' < "$NGINX_CONF/nginx.env.conf" > "$NGINX_CONF/nginx.conf"
fi

exec nginx -g "daemon off;" -c "$NGINX_CONF/nginx.conf"
